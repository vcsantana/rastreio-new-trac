# Diagrama da Estrutura de Usuários e Grupos

## 🏗️ Estrutura Hierárquica Atual

```
┌─────────────────────────────────────────────────────────────────┐
│                    SISTEMA TRACCAR                              │
│                 Usuários e Grupos                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        USUÁRIOS                                 │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ Admin User  │  │ GERENTE     │  │ Admin Test  │  │ Test User   │
│ (ID: 2)     │  │ PROTEGE     │  │ (ID: 10)    │  │ (ID: 9)     │
│ admin@      │  │ (ID: 7)     │  │ admin2@     │  │ test@       │
│ traccar.com │  │ gerente@    │  │ test.com    │  │ test.com    │
│ ✅ ADMIN    │  │ gerente.com │  │ ✅ ADMIN    │  │ ❌ USER     │
│ ✅ ATIVO    │  │ ✅ ADMIN    │  │ ✅ ATIVO    │  │ ✅ ATIVO    │
└─────────────┘  │ ✅ ATIVO    │  └─────────────┘  └─────────────┘
                 └─────────────┘
                          │
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│ Usuário     │  │ VANDECARLOS │  │             │
│ Teste       │  │ CAVALCANTI  │  │             │
│ (ID: 5)     │  │ (ID: 8)     │  │             │
│ teste@      │  │ vandecarlos │  │             │
│ example.com │  │ .santana@   │  │             │
│ ❌ USER     │  │ gmail.com   │  │             │
│ ✅ ATIVO    │  │ ❌ USER     │  │             │
└─────────────┘  │ ✅ ATIVO    │  │             │
                 └─────────────┘  │             │
                          │       │             │
                          └───────┼─────────────┘
                                  │
                          ┌───────▼─────────────┐
                          │   PERMISSÕES        │
                          │   DE GRUPO          │
                          └─────────────────────┘
                                  │
                          ┌───────▼─────────────┐
                          │ Admin User → SUPORTE│
                          │ VANDECARLOS → CLEINTE B │
                          └─────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                        GRUPOS                                   │
└─────────────────────────────────────────────────────────────────┘

                    ┌─────────────────┐
                    │    SUPORTE      │
                    │   (ID: 8)       │
                    │ Nível: 0        │
                    │ Grupo Raiz      │
                    │ ✅ ATIVO        │
                    └─────────┬───────┘
                              │
                    ┌─────────┴───────┐
                    │                 │
            ┌───────▼───────┐ ┌───────▼───────┐
            │  CLEINTE A    │ │  CLEINTE B    │
            │   (ID: 13)    │ │   (ID: 15)    │
            │ Nível: 1      │ │ Nível: 1      │
            │ Pai: SUPORTE  │ │ Pai: SUPORTE  │
            │ ✅ ATIVO      │ │ ✅ ATIVO      │
            └───────┬───────┘ └───────────────┘
                    │
            ┌───────▼───────┐
            │  CLEINTE AA   │
            │   (ID: 14)    │
            │ Nível: 2      │
            │ Pai: CLEINTE A│
            │ ✅ ATIVO      │
            └───────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                      DISPOSITIVOS                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────┐  ┌─────────────────┐
│  Test Device    │  │ 47733387-iPhone │
│   (ID: 12)      │  │   (ID: 13)      │
│ Unique: TEST123 │  │ Unique: 47733387│
│ Grupo: NENHUM   │  │ Grupo: CLEINTE B│
│ Pessoa: NENHUMA │  │ Pessoa: NENHUMA │
│ ✅ ATIVO        │  │ ✅ ATIVO        │
└─────────────────┘  └─────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    MAPEAMENTO DE ACESSOS                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    USUÁRIOS ADMIN                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────────────────────────────────────┐
│ Admin User  │    │ ✅ ACESSO TOTAL A TODOS OS RECURSOS         │
│ (ID: 2)     │    │ ✅ TODOS OS DISPOSITIVOS                    │
│             │    │ ✅ TODAS AS PESSOAS                         │
│ GERENTE     │    │ ✅ TODOS OS GRUPOS                          │
│ PROTEGE     │    │ ✅ FUNCIONALIDADES ADMINISTRATIVAS          │
│ (ID: 7)     │    │ ✅ REPORTS, LOGS, SETTINGS, USERS          │
│             │    │ ✅ GERENCIAMENTO COMPLETO                   │
│ Admin Test  │    └─────────────────────────────────────────────┘
│ (ID: 10)    │
└─────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                  USUÁRIOS REGULARES                             │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────────────────────────────────────┐
│ VANDECARLOS │    │ ✅ ACESSO APENAS AO GRUPO CLEINTE B         │
│ (ID: 8)     │    │ ✅ DISPOSITIVO: 47733387-iPhone             │
│             │    │ ❌ DISPOSITIVO: Test Device (sem grupo)     │
│ Usuário     │    │ ❌ FUNCIONALIDADES ADMINISTRATIVAS          │
│ Teste       │    │ ❌ REPORTS, LOGS, SETTINGS, USERS          │
│ (ID: 5)     │    │ ❌ GERENCIAMENTO DE OUTROS USUÁRIOS         │
│             │    └─────────────────────────────────────────────┘
│ Test User   │
│ (ID: 9)     │    ┌─────────────────────────────────────────────┐
└─────────────┘    │ ❌ SEM PERMISSÕES DE GRUPO                  │
                   │ ❌ NENHUM DISPOSITIVO VISÍVEL               │
                   │ ❌ NENHUMA PESSOA VISÍVEL                   │
                   │ ❌ FUNCIONALIDADES ADMINISTRATIVAS          │
                   │ ❌ REPORTS, LOGS, SETTINGS, USERS          │
                   └─────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    HERANÇA DE PERMISSÕES                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│  USUÁRIO COM PERMISSÃO NO GRUPO SUPORTE (ID: 8)                │
└─────────────────────────────────────────────────────────────────┘

                    ┌─────────────────┐
                    │    SUPORTE      │
                    │   (ID: 8)       │
                    │ ✅ ACESSO DIRETO│
                    └─────────┬───────┘
                              │
                    ┌─────────┴───────┐
                    │                 │
            ┌───────▼───────┐ ┌───────▼───────┐
            │  CLEINTE A    │ │  CLEINTE B    │
            │   (ID: 13)    │ │   (ID: 15)    │
            │ ✅ HERDADO    │ │ ✅ HERDADO    │
            └───────┬───────┘ └───────────────┘
                    │
            ┌───────▼───────┐
            │  CLEINTE AA   │
            │   (ID: 14)    │
            │ ✅ HERDADO    │
            │ (2 níveis)    │
            └───────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                      FLUXO DE AUTENTICAÇÃO                      │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   LOGIN     │───▶│ VALIDAÇÃO   │───▶│ GERAÇÃO     │───▶│ ACESSO      │
│             │    │ CREDENCIAIS │    │ TOKEN JWT   │    │ SISTEMA     │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ email/      │    │ Verifica    │    │ Token com   │    │ Filtros     │
│ password    │    │ hash        │    │ user_id     │    │ baseados    │
│             │    │             │    │ is_admin    │    │ em grupos   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    VALIDAÇÃO DE PERMISSÕES                      │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ REQUISIÇÃO  │───▶│ VERIFICA    │───▶│ CALCULA     │───▶│ RETORNA     │
│ API         │    │ TOKEN JWT   │    │ GRUPOS      │    │ DADOS       │
│             │    │             │    │ ACESSÍVEIS  │    │ FILTRADOS   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘
       │                   │                   │                   │
       ▼                   ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Headers:    │    │ user_id     │    │ Grupos      │    │ Apenas      │
│ Authorization│    │ is_admin    │    │ diretos +   │    │ recursos    │
│ Bearer token│    │             │    │ herdados    │    │ permitidos  │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    TIPOS DE ACESSO                              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    ADMINISTRADORES                              │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Dashboard   │    │ Devices     │    │ Groups      │    │ Persons     │
│ ✅ ACESSO   │    │ ✅ TODOS    │    │ ✅ TODOS    │    │ ✅ TODAS    │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reports     │    │ Logs        │    │ Users       │    │ Settings    │
│ ✅ ACESSO   │    │ ✅ ACESSO   │    │ ✅ ACESSO   │    │ ✅ ACESSO   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    USUÁRIOS REGULARES                           │
└─────────────────────────────────────────────────────────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Dashboard   │    │ Devices     │    │ Groups      │    │ Persons     │
│ ✅ ACESSO   │    │ 🔒 FILTRADOS│    │ 🔒 FILTRADOS│    │ 🔒 FILTRADAS│
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ Reports     │    │ Logs        │    │ Users       │    │ Settings    │
│ ❌ NEGADO   │    │ ❌ NEGADO   │    │ ❌ NEGADO   │    │ ❌ NEGADO   │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    RESUMO ESTATÍSTICO                           │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    USUÁRIOS: 6                                  │
│ • Administradores: 3 (50%)                                     │
│ • Usuários Regulares: 3 (50%)                                  │
│ • Usuários Ativos: 6 (100%)                                    │
│ • Usuários com Permissões: 2 (33%)                             │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    GRUPOS: 4                                    │
│ • Grupos Raiz: 1 (25%)                                         │
│ • Grupos de Nível 1: 2 (50%)                                   │
│ • Grupos de Nível 2: 1 (25%)                                   │
│ • Grupos Ativos: 4 (100%)                                      │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    DISPOSITIVOS: 2                              │
│ • Com Grupo: 1 (50%)                                           │
│ • Sem Grupo: 1 (50%)                                           │
│ • Dispositivos Ativos: 2 (100%)                                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                    PERMISSÕES: 2                                │
│ • Admin User → SUPORTE (acesso a todos os filhos)              │
│ • VANDECARLOS → CLEINTE B (acesso limitado)                    │
└─────────────────────────────────────────────────────────────────┘
